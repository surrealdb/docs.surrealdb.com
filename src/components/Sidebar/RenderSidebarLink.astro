---
import {
    getSdkJsRelativePath,
    isSdkJsPath,
} from '@src/util/sdkJsVersion';
import {
    getSurrealQLRelativePath,
    isSurrealQLPath,
} from '@src/util/surrealqlVersion';
import { cn } from '@src/util/tailwind';

export type SidebarLink = {
    title: string;
    href: string;
    slug: string;
    items?: never;
};

const { title, href } = Astro.props;

// For SurrealQL pages, normalize paths to compare (ignore version prefix)
let active: boolean;
if (isSurrealQLPath(Astro.url.pathname) && isSurrealQLPath(href)) {
    const currentRelative = getSurrealQLRelativePath(Astro.url.pathname);
    const hrefRelative = getSurrealQLRelativePath(href);
    active = currentRelative === hrefRelative;
} else if (isSdkJsPath(Astro.url.pathname) && isSdkJsPath(href)) {
    const currentRelative = getSdkJsRelativePath(Astro.url.pathname);
    const hrefRelative = getSdkJsRelativePath(href);
    active = currentRelative === hrefRelative;
} else {
    active = Astro.url.pathname === href;
}
---

<a
	href={href}
	class={cn(
		"sidebar-link text-sm text-faint px-4 py-1.5 w-full block cursor-pointer rounded-lg hover:bg-slate-600/10 hover:text-slate-600 hover:dark:text-slate-200",
		active &&
			"!text-surreal-energy dark:text-surreal-energy bg-surreal-energy/20 hover:dark:text-surreal-energy hover:bg-surreal-energy/25",
	)}
>
	{title}
</a>
