---
import Image from '@components/Image.astro';
import Search from '@src/components/Search.astro';
import { matchUrl } from '@src/util/helpers';
import { cn } from '@src/util/tailwind';
import { Icon } from 'astro-icon/components';
import { navItems, socialLinks } from './navItems';
---

<style>
	details > summary {
		list-style: none;
	}

	details > summary::-webkit-details-marker {
		display: none;
	}
</style>

<div class="fixed inset-0 z-50 bg-background/70 backdrop-blur-md opacity-0 transition-opacity pointer-events-none peer-checked:opacity-100 peer-checked:pointer-events-auto xl:hidden">
	<label for="mobile-nav-toggle" class="absolute inset-0 cursor-pointer"></label>
</div>
<div class="fixed inset-y-0 right-0 z-50 w-full max-w-sm translate-x-full border-l border-border bg-background-secondary shadow-2xl transition-transform pointer-events-none peer-checked:translate-x-0 peer-checked:pointer-events-auto xl:hidden">
	<div class="flex h-full flex-col">
		<div class="flex items-center justify-between border-b border-border px-6 py-4">
			<span class="text-xs uppercase tracking-[0.25em] text-text/60">Navigation</span>
			<label for="mobile-nav-toggle" class="rounded-lg p-2 text-text/70 transition-colors hover:bg-bwr/10">
				<Icon name="fa6-solid:xmark" class="h-4 w-4" />
			</label>
		</div>
		<div class="flex-1 overflow-y-auto px-6 py-6">
			<div class="mb-6">
				<Search isMobile={true} />
			</div>
			<div class="space-y-3">
				{navItems.map((item) => {
					const active =
						typeof item.href === 'string'
							? matchUrl(Astro.url.pathname, item.href)
							: item.href.some(
									(subItem) =>
										subItem.href &&
										matchUrl(Astro.url.pathname, subItem.href)
								);

					return typeof item.href === 'string' ? (
						<a
							href={item.href}
							class={cn(
								'flex items-center justify-between rounded-lg px-3 py-2.5 text-base font-medium text-text/80 transition-colors hover:bg-code/80',
								active && 'text-surreal-pink'
							)}
						>
							<span>{item.label}</span>
							<Icon
								name="fa6-solid:chevron-right"
								class="h-3 w-3 text-text/50"
							/>
						</a>
					) : (
						<details class="group rounded-lg" open={active}>
							<summary
								class={cn(
									'flex cursor-pointer items-center justify-between rounded-lg px-3 py-2.5 text-base font-medium text-text/80 transition-colors hover:bg-code/80',
									active && 'text-surreal-pink'
								)}
							>
								<span>{item.label}</span>
								<Icon
									name="fa6-solid:chevron-down"
									class="h-3 w-3 text-text/60 transition-transform group-open:rotate-180"
								/>
							</summary>
							<div class="mt-2 flex flex-col gap-1 border-l border-border/60 pl-4">
								{item.href.map((subItem) => {
									const subActive =
										!!subItem.href &&
										matchUrl(Astro.url.pathname, subItem.href);

									return (
										<a
											href={subItem.href}
											class={cn(
												'group flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-text/60 transition-colors hover:bg-code/80 hover:text-text',
												subActive && 'text-surreal-pink'
											)}
										>
											{subItem.icon && (
												<Image
													src={subItem.icon}
													alt={subItem.title}
													class="size-4"
												/>
											)}
											<span class="flex-1">{subItem.title}</span>
											{subItem.external && (
												<Icon
													name="fa6-solid:arrow-up-right-from-square"
													class="h-3 w-3"
												/>
											)}
										</a>
									);
								})}
							</div>
						</details>
					);
				})}
			</div>
			<div class="mt-8 flex flex-wrap items-center gap-4 border-t border-border py-6 text-text/70">
				{socialLinks.map((link) => (
					<a href={link.href} aria-label={link.label}>
						<Icon name={link.icon} class="h-4 w-4" />
					</a>
				))}
			</div>
			<div class="border-t border-border">
				<a
					href="https://app.surrealdb.com/signin"
					class="gradient-button !text-white flex w-full items-center justify-center gap-2 mt-4"
				>
					Sign in
					<Icon name="fa6-solid:chevron-right" class="w-4 text-xs" />
				</a>
			</div>
		</div>
	</div>
</div>
