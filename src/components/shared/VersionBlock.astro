---
import {
    type SurrealQLVersion,
    getVersionFromPath,
    versionMatches,
} from '@src/util/surrealqlVersion';

interface Props {
    since: string; // Version string like "v2.0.0", "v3.0.0-beta"
    until?: string; // Optional: Version string where this content is deprecated
    // Optional: specify if this is for SurrealQL docs (auto-detected from URL)
    isSurrealQL?: boolean;
}

const { since, until, isSurrealQL } = Astro.props;

// Auto-detect if we're on a SurrealQL page
const pathname = Astro.url.pathname;
const isSurrealQLPage =
    isSurrealQL ??
    (pathname.startsWith('/docs/surrealql') ||
        pathname.startsWith('/docs/2.x/surrealql') ||
        pathname.startsWith('/docs/3.x/surrealql'));

let shouldRender = true;

if (isSurrealQLPage) {
    const currentVersion = getVersionFromPath(pathname);

    // Check if this content should be visible in the current version
    const isAvailable = versionMatches(since, currentVersion);

    // If until is specified, check if content is deprecated in this version
    if (until && isAvailable) {
        const isDeprecated = versionMatches(until, currentVersion);
        shouldRender = !isDeprecated;
    } else {
        shouldRender = isAvailable;
    }
}
---

{shouldRender && <slot />}

