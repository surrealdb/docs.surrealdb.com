---
sidebar_position: 7
sidebar_label: Creating language tests
title: Creating language tests | Reference guides
description: SurrealDB's internal language tests tool is open source and can be used by ambitious developers.
---

# Language tests tool

SurrealDB is developed with an extensive test suite found at [this part](https://github.com/surrealdb/surrealdb/tree/main/language-tests) of the core database repo which has over 8000 assertions for behaviour. These language tests are run for every PR submitted to the core database.

**This tool is a completely internal tool created for the SurrealDB core developers, and does not take community input into account.**

However, it is also open source and thus can be used by anyone else who wants to develop a similar test suite. It is especially effective as a proof of concept for teams inside companies that would like to migrate to SurrealDB and need to convince a decision maker higher up the org chain in a limited amount of time.

One of the main advantages to using the language tests tool is that it can be configured for a variety of options and situations, such as confirming permissions by authenticated user type, importing setup files, configuring timeouts, and so on.

The readme file of this crate contains all of the documentation needed to create language tests for SurrealDB. This page will introduce a quick walkthrough to allow you to quickly try out a few examples before moving on to the main documentation for the tool.

## Quick walkthrough

First, make sure that you have the [Rust programming language installed](https://rust-lang.org/tools/install/).

Next, [clone the SurrealDB repo](https://github.com/surrealdb/surrealdb), go into the language-tests folder directly and start building the binary.

```bash
git clone https://github.com/surrealdb/surrealdb
cd surrealdb/language-tests
# Debug build: faster, less performant
cargo build
```

While the binary builds, create a new directory for your tests, such as `my_tests`.

```bash
mkdir my_tests
cd my_tests
```

> [!NOTE]
> Change `/* *` in the examples below to `/**` to allow the tests to be parsed. They are displayed here with a single extra space as language tests are automatically removed from view when deploying the SurrealDB documentation.

Inside the directory, create two new files called `basic.surql` and `error.surql` with the following content.

```surql title="basic.surql"
/* * <-- change this to /**
[test]

[[test.results]]
value = "NONE"

[[test.results]]
value = "person:one"

*/

DEFINE TABLE person;
CREATE person:one;
```

```surql title="error.surql"
/* * <-- change this to /**
[test]

[[test.results]]
error = "Tried to set `$num`, but couldn't coerce value: Expected `int` but found `'9'`"

*/

LET $num: int = "9";
```

Once the binary has built in the main directory, you can run the tests with the following command.

```bash
# Run the debug build
cargo run run --path ./my_tests
```

They will succeed with the following output.

```
 Running with 14 jobs
 Found 2 tests
 Finished ./my_tests/basic.surql Success ✓
 Finished ./my_tests/error.surql Success ✓
 2/2 [========================================================================>]
 2 passed
```

## Advantages of using language tests

So far we have only looked at two small examples that can be confirmed at any point by doing a quick query yourself.

Let's now get to the advantages mentioned above of being able to configure languages tests to fit a large variety of use cases. Some of them are:

- Matching expressions and rough equality, so that you can assert that dynamic output like random record IDs and datetimes are of the required type but not an exact match
- Environment setup to use a certain backend (e.g. mem, rocksdb)
- Environment setup to authenticate at certain levels such as `auth = { namespace = "ns", database = "db", level = "viewer" }` for a system user or `auth = { namespace = "ns", database = "db", access = "access_definition", rid = "user:account" }` for a record user
- Environment setup with timeout per test (`timeout = 2000`), timeout per query (`context-timeout = 1000`)
- Environment setup with an import file to execute before the test

And many more. Such configurations take much more time to test and assert when done manually.

To show these setup parameters in action, let's loook at how to verify permissions for a record user. As a record user won't be able to define its own tables, a separate `.surql` file can be used to set this up. Both of these statements will work because root access is the default for tests.

Note the `run = false` part of the file. This test could also be run on its own, but we don't particularly care to test whether two simple `DEFINE` statements work.

```surql title="define_schema.surql"
/* * <-- change this to /**
[test]
run = false

[[test.results]]
value = "NONE"

[[test.results]]
value = "NONE"

*/

DEFINE TABLE person PERMISSIONS NONE;
DEFINE TABLE user PERMISSIONS FULL;
```

The next test file will import the first file, log in as a record user using the `auth` option below `[env]`, and then try out some queries.

This test will also pass. In addition, it shows to anyone glancing at the code that `SELECT * FROM person` for an account not permitted to view this table will return an `[]` empty array instead of an IAM error. However, trying to `DEFINE` one's own table as a record user will show an error instead.

```surql
/* * <-- change this to /**
[test]

[env]
imports = ["define_schema.surql"]
auth = { namespace = "test", database = "test", access = "access_definition", rid = "user:account" }

[[test.results]]
value = "[]"

[[test.results]]
value = "[]"

[[test.results]]
value = "[{ id: user:one }]"

[[test.results]]
value = "[{ id: user:one }]"

[[test.results]]
error = "IAM error: Not enough permissions to perform this action"

*/

CREATE person:one;
SELECT * FROM person;

CREATE user:one;
SELECT * FROM user;

DEFINE TABLE my_table;
```

For more examples of language tests, simply open up the SurrealDB repo and search for `[[test.results]]`.