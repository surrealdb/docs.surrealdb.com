---
sidebar_position: 6
sidebar_label: Escape Functions
title: JavaScript | SDK | API Reference | Escape Functions
description: Functions for escaping identifiers and values in SurrealQL queries.
---

import Label from "@components/shared/Label.astro";

# Escape Functions {#escape}

Escape functions provide safe handling of identifiers and values in SurrealQL queries when you need to construct queries manually.

> [!TIP]
> Prefer using [`surql`](/docs/sdk/javascript/api/utilities/surql) or [`BoundQuery`](/docs/sdk/javascript/api/utilities/bound-query) for automatic parameterization. Use escape functions only when absolutely necessary.

**Import:**
```ts
import { 
    escapeIdent,
    escapeKey,
    escapeRid,
    escapeValue
} from 'surrealdb';
```

**Source:** [utils/escape.ts](https://github.com/surrealdb/surrealdb.js/blob/main/packages/sdk/src/utils/escape.ts)

## Functions

### `escapeIdent(name)` {#escapeident}

Escape table names, field names, and other identifiers.

```ts title="Signature"
function escapeIdent(name: string): string
```

#### Parameters
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>name</code> <Label label="required" /></td>
            <td><code>string</code></td>
            <td>The identifier to escape.</td>
        </tr>
    </tbody>
</table>

#### Returns
`string` - Escaped identifier

#### Examples

```ts
import { escapeIdent } from 'surrealdb';

// Simple identifiers (no escaping needed)
console.log(escapeIdent('users')); // 'users'
console.log(escapeIdent('first_name')); // 'first_name'

// Special characters (wrapped in backticks)
console.log(escapeIdent('user-table')); // '`user-table`'
console.log(escapeIdent('my table')); // '`my table`'
console.log(escapeIdent('user.name')); // '`user.name`'

// Reserved keywords
console.log(escapeIdent('select')); // '`select`'
console.log(escapeIdent('from')); // '`from`'
```

---

### `escapeKey(key)` {#escapekey}

Escape object keys for use in queries.

```ts title="Signature"
function escapeKey(key: string): string
```

#### Returns
`string` - Escaped key

#### Example

```ts
const key = 'user-property';
console.log(escapeKey(key)); // Properly escaped for object notation
```

---

### `escapeRid(value)` {#escaperid}

Escape record ID components.

```ts title="Signature"
function escapeRid(value: string | number): string
```

#### Parameters
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>value</code> <Label label="required" /></td>
            <td><code>string | number</code></td>
            <td>The record ID component to escape.</td>
        </tr>
    </tbody>
</table>

#### Returns
`string` - Escaped record ID component

#### Examples

```ts
import { escapeRid } from 'surrealdb';

// Simple IDs
console.log(escapeRid('john')); // 'john'
console.log(escapeRid(123)); // '123'

// IDs with special characters
console.log(escapeRid('user-123')); // '`user-123`'
console.log(escapeRid('user@email.com')); // '`user@email.com`'
```

---

### `escapeValue(value)` {#escapevalue}

Escape values for use in queries.

```ts title="Signature"
function escapeValue(value: unknown): string
```

#### Parameters
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>value</code> <Label label="required" /></td>
            <td><code>unknown</code></td>
            <td>The value to escape.</td>
        </tr>
    </tbody>
</table>

#### Returns
`string` - Escaped value representation

#### Examples

```ts
import { escapeValue } from 'surrealdb';

// Strings
console.log(escapeValue('hello')); // "'hello'"
console.log(escapeValue("O'Reilly")); // "'O\\'Reilly'"

// Numbers
console.log(escapeValue(42)); // '42'
console.log(escapeValue(3.14)); // '3.14'

// Booleans
console.log(escapeValue(true)); // 'true'
console.log(escapeValue(false)); // 'false'

// null/undefined
console.log(escapeValue(null)); // 'null'
console.log(escapeValue(undefined)); // 'none'
```

## Complete Examples

### Dynamic Table Names

```ts
import { escapeIdent } from 'surrealdb';

async function selectFromTable(tableName: string) {
    // Validate and escape table name
    const safeTable = escapeIdent(tableName);
    
    // Use in query (still prefer Table class)
    const query = `SELECT * FROM ${safeTable}`;
    const [results] = await db.query(query).collect();
    
    return results;
}

await selectFromTable('user-sessions'); // Safe
```

### Dynamic Field Selection

```ts
import { escapeIdent } from 'surrealdb';

async function selectFields(table: string, fields: string[]) {
    const escapedFields = fields.map(escapeIdent).join(', ');
    const escapedTable = escapeIdent(table);
    
    const query = `SELECT ${escapedFields} FROM ${escapedTable}`;
    const [results] = await db.query(query).collect();
    
    return results;
}

await selectFields('users', ['first-name', 'last-name', 'email']);
```

### Building Raw Queries (Not Recommended)

```ts
// Only when you absolutely must build raw queries
import { escapeIdent, escapeValue } from 'surrealdb';

function buildUnsafeQuery(table: string, filters: Record<string, unknown>) {
    const escapedTable = escapeIdent(table);
    
    const conditions = Object.entries(filters)
        .map(([key, value]) => {
            const field = escapeIdent(key);
            const val = escapeValue(value);
            return `${field} = ${val}`;
        })
        .join(' AND ');
    
    return `SELECT * FROM ${escapedTable} WHERE ${conditions}`;
}

// Better: Use surql instead!
const filters = { status: 'active', age: 18 };
const query = surql`
    SELECT * FROM users 
    WHERE status = ${filters.status} 
    AND age = ${filters.age}
`;
```

## When to Use

### ✅ Use Escape Functions When:
- Constructing queries with user-provided table/field names
- Working with identifiers that have special characters
- Building dynamic schema definitions
- Interfacing with external query builders

### ❌ Prefer Other Solutions:
- **For values:** Use [`surql`](/docs/sdk/javascript/api/utilities/surql) or [`BoundQuery`](/docs/sdk/javascript/api/utilities/bound-query)
- **For tables:** Use [`Table`](/docs/sdk/javascript/api/values/table) class
- **For record IDs:** Use [`RecordId`](/docs/sdk/javascript/api/values/record-id) class
- **For conditions:** Use [`expr`](/docs/sdk/javascript/api/utilities/expr)

## Best Practices

### 1. Prefer Type-Safe Alternatives

```ts
// Good: Type-safe
const table = new Table('users');
const users = await db.select(table);

// Avoid: Manual escaping
const escaped = escapeIdent('users');
const users = await db.query(`SELECT * FROM ${escaped}`).collect();
```

### 2. Validate Before Escaping

```ts
// Good: Validate first
function safeQuery(tableName: string) {
    if (!isValidTable(tableName)) {
        throw new Error('Invalid table name');
    }
    
    const escaped = escapeIdent(tableName);
    return `SELECT * FROM ${escaped}`;
}

// Avoid: Blind escaping
function unsafeQuery(tableName: string) {
    return `SELECT * FROM ${escapeIdent(tableName)}`;
}
```

### 3. Use surql for Complex Queries

```ts
// Good: Automatic parameterization
const query = surql`SELECT * FROM users WHERE name = ${name}`;

// Avoid: Manual escaping
const query = `SELECT * FROM users WHERE name = ${escapeValue(name)}`;
```

## Security Considerations

> [!WARNING]
> Escaping functions are NOT a complete defense against SQL injection. Always prefer parameterized queries using `surql` or `BoundQuery`.

```ts
// Secure: Parameterized
const query = surql`SELECT * FROM users WHERE name = ${userInput}`;

// Less secure: Manual escaping
const query = `SELECT * FROM users WHERE name = ${escapeValue(userInput)}`;

// Insecure: No escaping
const query = `SELECT * FROM users WHERE name = '${userInput}'`;
```

## See Also

- [surql](/docs/sdk/javascript/api/utilities/surql) - Recommended for parameterized queries
- [BoundQuery](/docs/sdk/javascript/api/utilities/bound-query) - Parameterized query class
- [Table](/docs/sdk/javascript/api/values/table) - Type-safe table references
- [RecordId](/docs/sdk/javascript/api/values/record-id) - Type-safe record identifiers
